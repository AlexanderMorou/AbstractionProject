 /* ----------------------------------------------------------\
 |  This code was generated by Allen Copeland's Abstraction.  |
 |  Version: 0.5.0.0                                          |
 |------------------------------------------------------------|
 |  To ensure the code works properly,                        |
 |  please do not make any changes to the file.               |
 |------------------------------------------------------------|
 |  The specific language is C♯                               |
 |  Sub-tool Name: C♯ Code Translator                         |
 |  Sub-tool Version: 1.0.0.0                                 |
 \---------------------------------------------------------- */
using AllenCopeland.Abstraction.IO;
using AllenCopeland.Abstraction.Slf.Cli.Metadata;
using AllenCopeland.Abstraction.Slf.Cli.Metadata.Tables;
using System;
using System.IO;
using System.Reflection;
namespace AllenCopeland.Abstraction.Slf._Internal.Cli.Metadata.Tables
{
    /// <summary>
    /// Provides a table which defines the information about the types within the image's
    /// metadata.
    /// </summary>
    internal class CliMetadataTypeDefinitionTableReader :
        CliMetadataLazyTable<ICliMetadataTypeDefinitionTableRow>, 
        ICliMetadataTable, 
        ICliMetadataTypeDefinitionTable
    {
        private ICliMetadataRoot metadataRoot;
        private EndianAwareBinaryReader reader;
        private object syncObject;
        private FileStream fStream;
        private uint rowCount;
        /// <summary>
        /// Size constant used when the total size of the <see cref="CliMetadataTypeDefinitionLockedTableRow"/>
        /// is 14 bytes long.
        /// </summary>
        internal const int __COR_TYPEDEFINITION_CALC_SIZE_1__ = 14;
        /// <summary>
        /// Size constant used when the total size of the <see cref="CliMetadataTypeDefinitionLockedTableRow"/>
        /// is 16 bytes long.
        /// </summary>
        internal const int __COR_TYPEDEFINITION_CALC_SIZE_2__ = 16;
        /// <summary>
        /// Size constant used when the total size of the <see cref="CliMetadataTypeDefinitionLockedTableRow"/>
        /// is 18 bytes long.
        /// </summary>
        internal const int __COR_TYPEDEFINITION_CALC_SIZE_3__ = 18;
        /// <summary>
        /// Size constant used when the total size of the <see cref="CliMetadataTypeDefinitionLockedTableRow"/>
        /// is 20 bytes long.
        /// </summary>
        internal const int __COR_TYPEDEFINITION_CALC_SIZE_4__ = 20;
        /// <summary>
        /// Size constant used when the total size of the <see cref="CliMetadataTypeDefinitionLockedTableRow"/>
        /// is 22 bytes long.
        /// </summary>
        internal const int __COR_TYPEDEFINITION_CALC_SIZE_5__ = 22;
        /// <summary>
        /// Size constant used when the total size of the <see cref="CliMetadataTypeDefinitionLockedTableRow"/>
        /// is 24 bytes long.
        /// </summary>
        internal const int __COR_TYPEDEFINITION_CALC_SIZE_6__ = 24;
        private int __size;
        private byte state;
        /// <summary>
        /// Data member which denotes where in the original stream the <see cref="CliMetadataTypeDefinitionTableReader"/>
        /// is.
        /// </summary>
        private long streamOffset;
        private long length;
        private bool fullyRead;
        public override CliMetadataTableKinds Kind
        {
            get
            {
                return CliMetadataTableKinds.TypeDefinition;
            }
        }
        public long Length
        {
            get
            {
                return this.length;
            }
        }
        /// <summary>
        /// Initializes the <see cref="CliMetadataTypeDefinitionTableReader"/> with the <paramref name="streamOffset"/>,<paramref name="fieldSize"/>,
        /// <paramref name="methodDefinitionSize"/>, <paramref name="stringsHeapSize"/>, and <paramref name="typeDefOrRefSize"/>
        /// provided.
        /// </summary>
        /// <param name="streamOffset">
        /// The <see cref="Int64"/> value which denotes where in the stream of <see cref="reader"/>
        /// the <see cref="CliMetadataTypeDefinitionTableReader"/> is.
        /// </param>
        /// <param name="fieldSize">
        /// The <see cref="AllenCopeland.Abstraction.Slf.Cli.Metadata.Tables.CliMetadataReferenceIndexSize"/>
        /// used to denote the word size of the <see cref="ICliMetadataFieldTable"/>.
        /// </param>
        /// <param name="methodDefinitionSize">
        /// The <see cref="AllenCopeland.Abstraction.Slf.Cli.Metadata.Tables.CliMetadataReferenceIndexSize"/>
        /// used to denote the word size of the <see cref="ICliMetadataMethodDefinitionTable"/>.
        /// </param>
        /// <param name="stringsHeapSize">
        /// The <see cref="AllenCopeland.Abstraction.Slf.Cli.Metadata.Tables.CliMetadataReferenceIndexSize"/>
        /// used to denote the word size of the <see cref="AllenCopeland.Abstraction.Slf._Internal.Cli.Metadata.CliMetadataStringsHeaderAndHeap"/>.
        /// </param>
        /// <param name="typeDefOrRefSize">
        /// The <see cref="AllenCopeland.Abstraction.Slf.Cli.Metadata.Tables.CliMetadataReferenceIndexSize"/>
        /// used to denote the word size of the indices nwith the <see cref="AllenCopeland.Abstraction.Slf.Cli.Metadata.CliMetadataTypeDefOrRefTag"/>
        /// encoding.
        /// </param>
        internal void Initialize(long streamOffset, CliMetadataReferenceIndexSize fieldSize, CliMetadataReferenceIndexSize methodDefinitionSize, CliMetadataReferenceIndexSize stringsHeapSize, CliMetadataReferenceIndexSize typeDefOrRefSize)
        {
            this.streamOffset = streamOffset;
            if (fieldSize == CliMetadataReferenceIndexSize.DWord)
                if (methodDefinitionSize == CliMetadataReferenceIndexSize.DWord)
                    if (stringsHeapSize == CliMetadataReferenceIndexSize.DWord)
                        if (typeDefOrRefSize == CliMetadataReferenceIndexSize.DWord)
                        {
                            this.state = 15;
                            this.__size = CliMetadataTypeDefinitionTableReader.__COR_TYPEDEFINITION_CALC_SIZE_6__;
                        }
                        else
                        {
                            this.state = 7;
                            this.__size = CliMetadataTypeDefinitionTableReader.__COR_TYPEDEFINITION_CALC_SIZE_5__;
                        }
                    else if (typeDefOrRefSize == CliMetadataReferenceIndexSize.DWord)
                    {
                        this.state = 11;
                        this.__size = CliMetadataTypeDefinitionTableReader.__COR_TYPEDEFINITION_CALC_SIZE_4__;
                    }
                    else
                    {
                        this.state = 3;
                        this.__size = CliMetadataTypeDefinitionTableReader.__COR_TYPEDEFINITION_CALC_SIZE_3__;
                    }
                else if (stringsHeapSize == CliMetadataReferenceIndexSize.DWord)
                    if (typeDefOrRefSize == CliMetadataReferenceIndexSize.DWord)
                    {
                        this.state = 13;
                        this.__size = CliMetadataTypeDefinitionTableReader.__COR_TYPEDEFINITION_CALC_SIZE_5__;
                    }
                    else
                    {
                        this.state = 5;
                        this.__size = CliMetadataTypeDefinitionTableReader.__COR_TYPEDEFINITION_CALC_SIZE_4__;
                    }
                else if (typeDefOrRefSize == CliMetadataReferenceIndexSize.DWord)
                {
                    this.state = 9;
                    this.__size = CliMetadataTypeDefinitionTableReader.__COR_TYPEDEFINITION_CALC_SIZE_3__;
                }
                else
                {
                    this.state = 1;
                    this.__size = CliMetadataTypeDefinitionTableReader.__COR_TYPEDEFINITION_CALC_SIZE_2__;
                }
            else if (methodDefinitionSize == CliMetadataReferenceIndexSize.DWord)
                if (stringsHeapSize == CliMetadataReferenceIndexSize.DWord)
                    if (typeDefOrRefSize == CliMetadataReferenceIndexSize.DWord)
                    {
                        this.state = 14;
                        this.__size = CliMetadataTypeDefinitionTableReader.__COR_TYPEDEFINITION_CALC_SIZE_5__;
                    }
                    else
                    {
                        this.state = 6;
                        this.__size = CliMetadataTypeDefinitionTableReader.__COR_TYPEDEFINITION_CALC_SIZE_4__;
                    }
                else if (typeDefOrRefSize == CliMetadataReferenceIndexSize.DWord)
                {
                    this.state = 10;
                    this.__size = CliMetadataTypeDefinitionTableReader.__COR_TYPEDEFINITION_CALC_SIZE_3__;
                }
                else
                {
                    this.state = 2;
                    this.__size = CliMetadataTypeDefinitionTableReader.__COR_TYPEDEFINITION_CALC_SIZE_2__;
                }
            else if (stringsHeapSize == CliMetadataReferenceIndexSize.DWord)
                if (typeDefOrRefSize == CliMetadataReferenceIndexSize.DWord)
                {
                    this.state = 12;
                    this.__size = CliMetadataTypeDefinitionTableReader.__COR_TYPEDEFINITION_CALC_SIZE_4__;
                }
                else
                {
                    this.state = 4;
                    this.__size = CliMetadataTypeDefinitionTableReader.__COR_TYPEDEFINITION_CALC_SIZE_3__;
                }
            else if (typeDefOrRefSize == CliMetadataReferenceIndexSize.DWord)
            {
                this.state = 8;
                this.__size = CliMetadataTypeDefinitionTableReader.__COR_TYPEDEFINITION_CALC_SIZE_2__;
            }
            else
            {
                this.state = 0;
                this.__size = CliMetadataTypeDefinitionTableReader.__COR_TYPEDEFINITION_CALC_SIZE_1__;
            }
            this.length = this.__size * this.rowCount;
        }
        protected override ICliMetadataTypeDefinitionTableRow ReadElementAt(uint index)
        {
            bool gotLock = false;
            System.Threading.Monitor.Enter(this.syncObject, ref gotLock);
            if (index == 0)
                return null;
            this.fStream.Seek(this.streamOffset + (index - 1) * this.__size, SeekOrigin.Begin);
            TypeAttributes typeAttributes = ((TypeAttributes)(this.reader.ReadUInt32()));
            uint nameIndex;
            uint namespaceIndex;
            switch (this.state)
            {
                case 4: case 5: case 6: case 7: case 12: case 13: case 14: case 15:
                    nameIndex = this.reader.ReadUInt32();
                    namespaceIndex = this.reader.ReadUInt32();
                    break;
                default:
                    nameIndex = this.reader.ReadUInt16();
                    namespaceIndex = this.reader.ReadUInt16();
                    break;
            }
            uint extendsIndex;
            CliMetadataTypeDefOrRefTag extendsSource;
            switch (this.state)
            {
                case 8: case 9: case 10: case 11: case 12: case 13: case 14: case 15:
                    extendsIndex = this.reader.ReadUInt32();
                    break;
                default:
                    extendsIndex = this.reader.ReadUInt16();
                    break;
            }
            extendsSource = ((CliMetadataTypeDefOrRefTag)(extendsIndex & 3));
            extendsIndex = extendsIndex >> 2;
            uint fieldStartIndex;
            switch (this.state)
            {
                case 1: case 3: case 5: case 7: case 9: case 11: case 13: case 15:
                    fieldStartIndex = this.reader.ReadUInt32();
                    break;
                default:
                    fieldStartIndex = this.reader.ReadUInt16();
                    break;
            }
            uint methodStartIndex;
            switch (this.state)
            {
                case 2: case 3: case 6: case 7: case 10: case 11: case 14: case 15:
                    methodStartIndex = this.reader.ReadUInt32();
                    break;
                default:
                    methodStartIndex = this.reader.ReadUInt16();
                    break;
            }
            if (gotLock)
                System.Threading.Monitor.Exit(this.syncObject);
            return new CliMetadataTypeDefinitionLockedTableRow(index, this.state, this.metadataRoot, typeAttributes, nameIndex, namespaceIndex, extendsSource, extendsIndex, fieldStartIndex, methodStartIndex);
        }
        public override void Read()
        {
            if (this.fullyRead)
                return;
            for (uint index = 1; index <= this.Count; index++)
            {
                bool gotLock = false;
                System.Threading.Monitor.Enter(this.syncObject, ref gotLock);
                if (!base.ItemLoaded(index))
                {
                    this.fStream.Seek(this.streamOffset + (index - 1) * this.__size, SeekOrigin.Begin);
                    TypeAttributes typeAttributes = ((TypeAttributes)(this.reader.ReadUInt32()));
                    uint nameIndex;
                    uint namespaceIndex;
                    switch (this.state)
                    {
                        case 4: case 5: case 6: case 7: case 12: case 13: case 14: case 15:
                            nameIndex = this.reader.ReadUInt32();
                            namespaceIndex = this.reader.ReadUInt32();
                            break;
                        default:
                            nameIndex = this.reader.ReadUInt16();
                            namespaceIndex = this.reader.ReadUInt16();
                            break;
                    }
                    uint extendsIndex;
                    CliMetadataTypeDefOrRefTag extendsSource;
                    switch (this.state)
                    {
                        case 8: case 9: case 10: case 11: case 12: case 13: case 14: case 15:
                            extendsIndex = this.reader.ReadUInt32();
                            break;
                        default:
                            extendsIndex = this.reader.ReadUInt16();
                            break;
                    }
                    extendsSource = ((CliMetadataTypeDefOrRefTag)(extendsIndex & 3));
                    extendsIndex = extendsIndex >> 2;
                    uint fieldStartIndex;
                    switch (this.state)
                    {
                        case 1: case 3: case 5: case 7: case 9: case 11: case 13: case 15:
                            fieldStartIndex = this.reader.ReadUInt32();
                            break;
                        default:
                            fieldStartIndex = this.reader.ReadUInt16();
                            break;
                    }
                    uint methodStartIndex;
                    switch (this.state)
                    {
                        case 2: case 3: case 6: case 7: case 10: case 11: case 14: case 15:
                            methodStartIndex = this.reader.ReadUInt32();
                            break;
                        default:
                            methodStartIndex = this.reader.ReadUInt16();
                            break;
                    }
                    base.InjectLoadedItem(new CliMetadataTypeDefinitionLockedTableRow(index, this.state, this.metadataRoot, typeAttributes, nameIndex, namespaceIndex, extendsSource, extendsIndex, fieldStartIndex, methodStartIndex), index);
                }
                if (gotLock)
                    System.Threading.Monitor.Exit(this.syncObject);
            }
            this.fullyRead = true;
        }
        public CliMetadataTypeDefinitionTableReader(ICliMetadataRoot metadataRoot, Tuple<object, FileStream, EndianAwareBinaryReader> readerInfo, uint rowCount)
            : base(metadataRoot, rowCount)
        {
            this.metadataRoot = metadataRoot;
            this.syncObject = readerInfo.Item1;
            this.fStream = readerInfo.Item2;
            this.reader = readerInfo.Item3;
            this.rowCount = rowCount;
        }
    };
};
